(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{64:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>_});var t=r(5155),a=r(2115),l=r(5695),o=r(6766),i=r(3168),n=r(6565),c=r(4835),d=r(646),u=r(1243),m=r(1007),g=r(3717),f=r(9869),h=r(227),x=r(8175),p=r(883),b=r(2645),y=r(3904),v=r(4213);function w(e){let{userId:s,onUploadComplete:r,onError:l}=e,[o,n]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(null),m=async e=>{var s;if(e.preventDefault(),d(!1),!(null===(s=e.dataTransfer)||void 0===s?void 0:s.files)||0===e.dataTransfer.files.length)return;let r=e.dataTransfer.files[0];await x(r)},g=async e=>{if(!e.target.files||0===e.target.files.length)return;let s=e.target.files[0];await x(s)},x=async e=>{try{var t;n(!0);let a=(null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase())||"";if("mp3"!==a)throw Error("Only MP3 files are allowed");let l="song-".concat(e.name),o=(0,i.ny)();try{let{data:e,error:r}=await o.storage.from("songs").list(s);if(!r&&e&&e.length>0){let r=e.map(e=>"".concat(s,"/").concat(e.name));r.length>0&&await o.storage.from("songs").remove(r)}}catch(e){console.error("Error handling existing files:",e)}let c="".concat(s,"/").concat(l),{error:d}=await o.storage.from("songs").upload(c,e,{upsert:!0,cacheControl:"0"});if(d)throw d;let{data:u}=o.storage.from("songs").getPublicUrl(c);"".concat(u.publicUrl,"?t=").concat(Date.now()),r()}catch(e){console.error("Error uploading song:",e),l("Error uploading song: ".concat(e.message))}finally{n(!1)}};return(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-md font-semibold mb-3",children:"Profile Song"}),(0,t.jsxs)("div",{ref:u,onDragOver:e=>{e.preventDefault(),d(!0)},onDragLeave:()=>{d(!1)},onDrop:m,className:"border ".concat(c?"border-yellow-500 bg-gray-800/50":"border-gray-700"," \n          p-4 rounded-md transition-colors relative"),children:[c&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-md z-10",children:(0,t.jsxs)("div",{className:"text-yellow-500 flex flex-col items-center",children:[(0,t.jsx)(f.A,{className:"h-8 w-8 mb-2"}),(0,t.jsx)("p",{children:"Drop to upload"})]})}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center mb-3",children:[(0,t.jsx)(h.A,{className:"h-5 w-5 text-yellow-500 mr-2"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"Upload an MP3 file for this profile"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"Drag & drop an MP3 file or select one below"}),(0,t.jsxs)("label",{className:"bg-yellow-600 hover:bg-yellow-500 text-black px-4 py-2 rounded cursor-pointer inline-block",children:[(0,t.jsx)("input",{type:"file",accept:".mp3,audio/mp3",className:"hidden",onChange:g,disabled:o}),o?"Uploading...":"Select MP3"]})]})]})]})}var j=r(4624),N=r(2085),k=r(2596),E=r(9688);let S=(0,N.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),C=a.forwardRef((e,s)=>{let{className:r,variant:a,size:l,asChild:o=!1,...i}=e,n=o?j.DX:"button";return(0,t.jsx)(n,{className:function(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,E.QP)((0,k.$)(s))}(S({variant:a,size:l,className:r})),ref:s,...i})});function I(e){let{onClose:s}=e,[r,l]=(0,a.useState)(!1),[o,n]=(0,a.useState)(""),c=(0,i.ny)(),d=async()=>{try{l(!0),n("Setting up storage buckets and policies...");let{error:e}=await c.rpc("create_storage_buckets");if(e){console.error("Error creating buckets:",e),n("Error creating buckets: ".concat(e.message));return}let{error:r}=await c.rpc("create_storage_policies");if(r){console.error("Error creating policies:",r),n("Error creating policies: ".concat(r.message));return}let{data:t}=await c.storage.listBuckets();for(let e of t||[])if("profile-picture"===e.name||"backgrounds"===e.name||"songs"===e.name){let{error:s}=await c.storage.updateBucket(e.name,{public:!0});s&&console.error("Failed to update bucket ".concat(e.name,":"),s)}n("Storage setup complete! Buckets and policies have been configured."),s&&setTimeout(()=>{s()},2e3)}catch(e){console.error("Error setting up storage:",e),n("Error: ".concat(e.message))}finally{l(!1)}};return(0,t.jsxs)("div",{className:"p-4 border border-gray-700 rounded-md",children:[(0,t.jsx)("h3",{className:"text-md font-semibold mb-3",children:"Storage Setup"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-3",children:"If you're having issues with uploads, run this setup to configure storage buckets and policies."}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)(C,{onClick:d,disabled:r,className:"bg-purple-700 hover:bg-purple-600 text-white",children:[(0,t.jsx)(v.A,{className:"h-4 w-4 mr-2 ".concat(r?"animate-pulse":"")}),r?"Setting up...":"Setup Storage Buckets"]}),s&&(0,t.jsx)(C,{onClick:s,variant:"outline",className:"ml-2",children:"Cancel"})]}),o&&(0,t.jsx)("div",{className:"mt-4 p-3 bg-gray-800 rounded text-sm",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap",children:o})})]})}C.displayName="Button";let U=["mp4","mov","avi","wmv","flv","mkv","webm","m4v","3gp","mpeg","mpg","ogg"];function _(){let[e,s]=(0,a.useState)(null),[r,j]=(0,a.useState)(!0),[N,k]=(0,a.useState)(!1),[E,S]=(0,a.useState)(!1),[C,_]=(0,a.useState)(null),[D,A]=(0,a.useState)(!1),[z,L]=(0,a.useState)(""),[R,M]=(0,a.useState)(!1),[P,B]=(0,a.useState)(""),[O,T]=(0,a.useState)(""),[W,J]=(0,a.useState)(""),[F,Q]=(0,a.useState)(null),[X,Y]=(0,a.useState)(null),[Z,V]=(0,a.useState)(null),[q,G]=(0,a.useState)(null),[H,K]=(0,a.useState)(!1),[$,ee]=(0,a.useState)(!1),[es,er]=(0,a.useState)(null),[et,ea]=(0,a.useState)(!1),el=(0,a.useRef)(null),eo=(0,a.useRef)(null),ei=(0,l.useRouter)(),en=(0,i.ny)();(0,a.useEffect)(()=>{(async()=>{try{j(!0);let{data:{user:r}}=await en.auth.getUser();if(!r){ei.push("/admin");return}let{data:t,error:a}=await en.from("profiles").select("*").eq("id",r.id);if(a)throw a;if(t&&t.length>0){let e=t[0];s(e),L(e.bio||""),B(e.twitter_url||""),T(e.twitch_url||""),J(e.steam_url||""),await ec(r.id)}else{var e;let t={id:r.id,username:(null===(e=r.email)||void 0===e?void 0:e.split("@")[0])||"batman",avatar_url:null,background_image:null,created_at:new Date().toISOString(),last_login:new Date().toISOString(),bio:null,is_admin:!1,twitter_url:null,twitch_url:null,github_url:null,steam_url:null},{error:a}=await en.from("profiles").insert([t]);a&&console.error("Error creating default profile:",a),s(t)}}catch(e){console.error("Error fetching data:",e),_({type:"error",message:"Failed to load profile data"})}finally{j(!1)}})()},[en,ei]),(0,a.useEffect)(()=>{let e=el.current;if(!e)return;let s=e=>{e.preventDefault(),ea(!0)},r=()=>{ea(!1)},t=async e=>{var s;if(e.preventDefault(),ea(!1),!(null===(s=e.dataTransfer)||void 0===s?void 0:s.files)||0===e.dataTransfer.files.length)return;let r=e.dataTransfer.files[0];await ef(r)};return e.addEventListener("dragover",s),e.addEventListener("dragleave",r),e.addEventListener("drop",t),()=>{e.removeEventListener("dragover",s),e.removeEventListener("dragleave",r),e.removeEventListener("drop",t)}},[e]);let ec=async e=>{try{K(!0);let s=await (0,n.r)(e);if(s.success&&s.files){if(er(s.files),s.files["profile-picture"]&&s.files["profile-picture"].length>0){let e=s.files["profile-picture"].find(e=>e.name.startsWith("pic."));e&&Q(e.publicUrl)}if(s.files.backgrounds&&s.files.backgrounds.length>0){let e=s.files.backgrounds.find(e=>e.name.startsWith("bg."));e&&Y(e.publicUrl)}if(s.files.songs&&s.files.songs.length>0){let e=s.files.songs.find(e=>e.name.startsWith("song-"));e&&(V(e.publicUrl),G(e.name.replace(/^song-/,"")))}}}catch(e){console.error("Error fetching user files:",e),_({type:"error",message:"Failed to load user files"})}finally{K(!1)}},ed=async()=>{await en.auth.signOut(),ei.push("/admin")},eu=async e=>{try{if(!e.target.files||0===e.target.files.length)throw Error("You must select an image to upload.");let s=e.target.files[0];await em(s)}catch(e){console.error("Error uploading avatar:",e),_({type:"error",message:"Error uploading avatar: ".concat(e.message)})}},em=async s=>{try{var r;k(!0);let t=(null===(r=s.name.split(".").pop())||void 0===r?void 0:r.toLowerCase())||"";if(U.includes(t))throw Error("Video files are not allowed. Please select an image file.");let a=await (0,n.Q)(s,"profile-picture",(null==e?void 0:e.id)||"","pic.".concat(t));if(!a.success)throw Error(a.error||"Upload failed");e&&await ec(e.id),_({type:"success",message:"Profile picture updated successfully"})}catch(e){console.error("Error uploading avatar:",e),_({type:"error",message:"Error uploading avatar: ".concat(e.message)})}finally{k(!1)}},eg=async e=>{try{if(!e.target.files||0===e.target.files.length)throw Error("You must select an image to upload.");let s=e.target.files[0];await ef(s)}catch(e){console.error("Error uploading background:",e),_({type:"error",message:"Error uploading background: ".concat(e.message)})}},ef=async s=>{try{var r;S(!0);let t=(null===(r=s.name.split(".").pop())||void 0===r?void 0:r.toLowerCase())||"";if(U.includes(t))throw Error("Video files are not allowed. Please select an image file.");let a=await (0,n.Q)(s,"backgrounds",(null==e?void 0:e.id)||"","bg.".concat(t));if(!a.success)throw Error(a.error||"Upload failed");e&&await ec(e.id),_({type:"success",message:"Background image updated successfully"})}catch(e){console.error("Error uploading background:",e),_({type:"error",message:"Error uploading background: ".concat(e.message)})}finally{S(!1)}},eh=async()=>{try{let{error:r}=await en.from("profiles").update({bio:z}).eq("id",null==e?void 0:e.id);if(r)throw r;s({...e,bio:z}),A(!1),_({type:"success",message:"Bio updated successfully"})}catch(e){console.error("Error updating bio:",e),_({type:"error",message:"Error updating bio: ".concat(e.message)})}},ex=async()=>{try{let{error:r}=await en.from("profiles").update({twitter_url:P||null,twitch_url:O||null,steam_url:W||null}).eq("id",null==e?void 0:e.id);if(r)throw r;s({...e,twitter_url:P||null,twitch_url:O||null,steam_url:W||null}),M(!1),_({type:"success",message:"Social links updated successfully"})}catch(e){console.error("Error updating social links:",e),_({type:"error",message:"Error updating social links: ".concat(e.message)})}},ep=async()=>{try{_({type:"success",message:"Refreshing files from storage..."}),e&&await ec(e.id),_({type:"success",message:"Files refreshed successfully"})}catch(e){console.error("Error refreshing files:",e),_({type:"error",message:"Error refreshing files: ".concat(e.message)})}},eb=async()=>{try{if(!(null==e?void 0:e.id))return;_({type:"success",message:"Deleting song..."});let s=(0,i.ny)(),{data:r,error:t}=await s.storage.from("songs").list(e.id);if(t)throw t;if(r&&r.length>0){let t=r.map(s=>"".concat(e.id,"/").concat(s.name)),{error:a}=await s.storage.from("songs").remove(t);if(a)throw a;await ec(e.id),V(null),G(null),_({type:"success",message:"Song deleted successfully"})}else _({type:"error",message:"No songs found to delete"})}catch(e){console.error("Error deleting song:",e),_({type:"error",message:"Error deleting song: ".concat(e.message)})}};return r?(0,t.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("p",{className:"mt-4",children:"Loading..."})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,t.jsx)("header",{className:"bg-gray-900 border-b border-gray-800",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,t.jsxs)("h1",{className:"text-xl font-bold",children:["BAT",(0,t.jsx)("span",{className:"text-yellow-500",children:"CONSOLE"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("button",{onClick:()=>{ei.push("/desktop")},className:"bg-yellow-600 hover:bg-yellow-500 text-black px-3 py-1.5 rounded-md text-sm flex items-center",children:"Desktop"}),(0,t.jsxs)("button",{onClick:ed,className:"bg-gray-800 hover:bg-gray-700 text-white px-3 py-1.5 rounded-md text-sm flex items-center",children:[(0,t.jsx)(c.A,{className:"h-4 w-4 mr-1"}),"Logout"]})]})]})}),C&&(0,t.jsx)("div",{className:"p-3 mx-auto max-w-4xl mt-4 rounded-md\n            ".concat("success"===C.type?"bg-green-900 border-l-4 border-green-500":"bg-red-900 border-l-4 border-red-500"),children:(0,t.jsxs)("div",{className:"flex items-center",children:["success"===C.type?(0,t.jsx)(d.A,{className:"h-5 w-5 text-green-400 mr-2"}):(0,t.jsx)(u.A,{className:"h-5 w-5 text-red-400 mr-2"}),(0,t.jsx)("p",{className:"text-sm",children:C.message}),(0,t.jsx)("button",{onClick:()=>_(null),className:"ml-auto text-gray-400 hover:text-white",children:"\xd7"})]})}),(0,t.jsx)("main",{className:"max-w-4xl mx-auto px-4 py-8",children:(0,t.jsx)("div",{className:"bg-gray-900 rounded-lg shadow-lg overflow-hidden border border-gray-800",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-6",children:"Profile Management"}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-8",children:[(0,t.jsx)("div",{className:"md:w-1/3",children:(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-32 h-32 rounded-full overflow-hidden mb-4 bg-gray-800 border-2 border-yellow-500",children:F?(0,t.jsx)(o.default,{src:F||"/placeholder.svg",alt:(null==e?void 0:e.username)||"User",width:128,height:128,className:"object-cover w-full h-full",unoptimized:!0}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsx)(m.A,{className:"h-16 w-16 text-gray-600"})})}),(0,t.jsx)("h3",{className:"text-lg font-medium",children:null==e?void 0:e.username}),(0,t.jsxs)("div",{className:"mt-4 w-full",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-400",children:"Bio"}),(0,t.jsx)("button",{onClick:()=>A(!D),className:"text-yellow-500 hover:text-yellow-400",children:(0,t.jsx)(g.A,{className:"h-4 w-4"})})]}),D?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("textarea",{value:z,onChange:e=>L(e.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded p-2 text-sm",rows:3}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)("button",{onClick:()=>A(!1),className:"px-3 py-1 text-sm bg-gray-800 hover:bg-gray-700 rounded",children:"Cancel"}),(0,t.jsx)("button",{onClick:eh,className:"px-3 py-1 text-sm bg-yellow-600 hover:bg-yellow-500 text-black rounded",children:"Save"})]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-300 bg-gray-800 p-2 rounded min-h-[60px]",children:(null==e?void 0:e.bio)||"No bio provided"})]})]})}),(0,t.jsxs)("div",{className:"md:w-2/3 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-md font-semibold mb-3",children:"Profile Picture"}),(0,t.jsx)("div",{className:"border border-gray-700 p-4 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"Upload a new profile picture (any non-video file)"}),(0,t.jsxs)("label",{className:"bg-yellow-600 hover:bg-yellow-500 text-black px-4 py-2 rounded cursor-pointer inline-block",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:eu,disabled:N}),N?"Uploading...":"Select Image"]})]}),F&&(0,t.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden",children:(0,t.jsx)(o.default,{src:F||"/placeholder.svg",alt:"Current avatar",width:64,height:64,className:"object-cover w-full h-full",unoptimized:!0})})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-md font-semibold mb-3",children:"Background Image"}),(0,t.jsxs)("div",{ref:el,className:"border ".concat(et?"border-yellow-500 bg-gray-800/50":"border-gray-700"," \n                      p-4 rounded-md transition-colors relative"),children:[et&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-md z-10",children:(0,t.jsxs)("div",{className:"text-yellow-500 flex flex-col items-center",children:[(0,t.jsx)(f.A,{className:"h-8 w-8 mb-2"}),(0,t.jsx)("p",{children:"Drop to upload"})]})}),(0,t.jsx)("div",{className:"mb-3",children:X?(0,t.jsx)("div",{className:"h-24 w-full rounded overflow-hidden",children:(0,t.jsx)(o.default,{src:X||"/placeholder.svg",alt:"Background",width:400,height:100,className:"object-cover w-full h-full",unoptimized:!0})}):(0,t.jsx)("div",{className:"h-24 w-full bg-gray-800 rounded flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-gray-500",children:"No background image"})})}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"Upload a new background image (drag & drop or select a file)"}),(0,t.jsxs)("label",{className:"bg-yellow-600 hover:bg-yellow-500 text-black px-4 py-2 rounded cursor-pointer inline-block",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:eg,disabled:E}),E?"Uploading...":"Select Image"]})]})]}),(0,t.jsx)(w,{userId:(null==e?void 0:e.id)||"",onUploadComplete:()=>{_({type:"success",message:"Song uploaded successfully"}),e&&ec(e.id)},onError:e=>{_({type:"error",message:e})}}),Z&&(0,t.jsx)("div",{className:"border border-gray-700 p-4 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(h.A,{className:"h-5 w-5 text-yellow-500 mr-2"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Current Song"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:q||"Unknown"})]})]}),(0,t.jsx)("button",{onClick:eb,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm",children:"Delete"})]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"text-md font-semibold",children:"Social Media"}),(0,t.jsx)("button",{onClick:()=>M(!R),className:"text-yellow-500 hover:text-yellow-400",children:(0,t.jsx)(g.A,{className:"h-4 w-4"})})]}),R?(0,t.jsxs)("div",{className:"border border-gray-700 p-4 rounded-md space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-400 mb-1",children:"Twitter URL"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(x.A,{className:"h-4 w-4 text-blue-400 mr-2"}),(0,t.jsx)("input",{type:"text",value:P,onChange:e=>B(e.target.value),placeholder:"https://twitter.com/username",className:"flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-sm"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-400 mb-1",children:"Twitch URL"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 text-purple-400 mr-2"}),(0,t.jsx)("input",{type:"text",value:O,onChange:e=>T(e.target.value),placeholder:"https://twitch.tv/username",className:"flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-sm"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-400 mb-1",children:"Steam URL"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(b.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,t.jsx)("input",{type:"text",value:W,onChange:e=>J(e.target.value),placeholder:"https://steamcommunity.com/id/username",className:"flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-sm"})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)("button",{onClick:()=>M(!1),className:"px-3 py-1 text-sm bg-gray-800 hover:bg-gray-700 rounded",children:"Cancel"}),(0,t.jsx)("button",{onClick:ex,className:"px-3 py-1 text-sm bg-yellow-600 hover:bg-yellow-500 text-black rounded",children:"Save"})]})]}):(0,t.jsxs)("div",{className:"border border-gray-700 p-4 rounded-md space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(x.A,{className:"h-4 w-4 text-blue-400 mr-2"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:P||"No Twitter link"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 text-purple-400 mr-2"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:O||"No Twitch link"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(b.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:W||"No Steam link"})]})]})]})]})]}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsxs)("button",{onClick:ep,className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-md text-sm flex items-center",disabled:H,children:[(0,t.jsx)(y.A,{className:"h-4 w-4 mr-2"}),H?"Refreshing...":"Refresh Files"]})}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsxs)("button",{onClick:()=>ee(!0),className:"bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-md text-sm flex items-center",children:[(0,t.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Setup Storage"]})})]})})}),$&&(0,t.jsx)(I,{onClose:()=>ee(!1)}),Z&&(0,t.jsx)("div",{className:"fixed bottom-0 left-0 w-full bg-gray-900 p-4 border-t border-gray-800",children:(0,t.jsx)("audio",{controls:!0,ref:eo,src:Z,className:"w-full"})})]})}},823:(e,s,r)=>{Promise.resolve().then(r.bind(r,64))},3168:(e,s,r)=>{"use strict";r.d(s,{ny:()=>l});var t=r(851);r(9509),(0,t.UU)("https://cgggsudeipsyfcszouil.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNnZ2dzdWRlaXBzeWZjc3pvdWlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4NTAzMDQsImV4cCI6MjA2MDQyNjMwNH0.rKNpG-VLYRYW5L9E3N0vWN_6mFzgNsafXxuI-bxrww4");let a=null;function l(){return a||(a=(0,t.UU)("https://cgggsudeipsyfcszouil.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNnZ2dzdWRlaXBzeWZjc3pvdWlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4NTAzMDQsImV4cCI6MjA2MDQyNjMwNH0.rKNpG-VLYRYW5L9E3N0vWN_6mFzgNsafXxuI-bxrww4",{auth:{persistSession:!0,autoRefreshToken:!0}})),a}},6565:(e,s,r)=>{"use strict";r.d(s,{Q:()=>l,r:()=>a});var t=r(3168);async function a(e){try{if(!e)return{success:!1,error:"User ID is required"};let s=(0,t.ny)(),r={},a=Date.now();for(let t of["profile-picture","backgrounds","songs"])try{let{data:l,error:o}=await s.storage.from(t).list(e);if(o){console.error("Error listing files in ".concat(t,":"),o);continue}let i=l.map(r=>{let l="".concat(e,"/").concat(r.name),{data:o}=s.storage.from(t).getPublicUrl(l);return{...r,publicUrl:"".concat(o.publicUrl,"?t=").concat(a),path:l,bucket:t}});r[t]=i}catch(e){console.error("Error getting files from ".concat(t,":"),e.message)}return{success:!0,files:r}}catch(e){return console.error("Error fetching user files:",e),{success:!1,error:e.message}}}async function l(e,s,r,a){try{if(!e)return{success:!1,error:"No file provided"};if(!s)return{success:!1,error:"No bucket specified"};if(!r)return{success:!1,error:"No user ID specified"};let l=(0,t.ny)();try{console.log("Checking for existing files in ".concat(s,"/").concat(r));let{data:e,error:t}=await l.storage.from(s).list(r);if(t)console.error("Error listing files in ".concat(s,"/").concat(r,":"),t);else if(e&&e.length>0){console.log("Found ".concat(e.length," existing files to delete"));let t=e.filter(e=>"backgrounds"===s||"songs"===s||!!("profile-picture"===s&&a.startsWith("pic."))&&e.name.startsWith("pic.")).map(e=>"".concat(r,"/").concat(e.name));if(t.length>0){console.log("Deleting ".concat(t.length," files:"),t);let{error:e}=await l.storage.from(s).remove(t);e?console.error("Error deleting files from ".concat(s,":"),e):console.log("Successfully deleted ".concat(t.length," files from ").concat(s))}}}catch(e){console.error("Error handling existing files in ".concat(s,":"),e)}let o="".concat(r,"/").concat(a);console.log("Uploading to path: ".concat(o," in bucket: ").concat(s));let{data:i,error:n}=await l.storage.from(s).upload(o,e,{upsert:!0,cacheControl:"0"});if(n)return console.error("Upload error:",n),{success:!1,error:n.message};let{data:{publicUrl:c}}=l.storage.from(s).getPublicUrl(o);console.log("Upload successful, public URL:",c);let d="".concat(c,"?t=").concat(Date.now());return{success:!0,url:d,path:(null==i?void 0:i.path)||o}}catch(e){return console.error("Upload error:",e),{success:!1,error:e.message}}}}},e=>{var s=s=>e(e.s=s);e.O(0,[294,829,721,441,684,358],()=>s(823)),_N_E=e.O()}]);